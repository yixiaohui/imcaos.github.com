---
title: 路由器内网端口做外网映射的记录
author: Caos
layout: post
permalink:  //

tags:
  - 运维
  
  
---

## 写在前边

相信很多运维人员都有折腾过路由器配置的经历，对于一个半路出家只会写代码的程序员来说，想在短时间内搞明白计算机网络和通信的那些知识，的确不容易，采坑的经历也值得回过头来好好的总结一下。

<!--more-->



为了让这份总结对想了解的人有价值，我决定写的抽象一些，不谈具体的配置，而是归纳为一种自检清单的形式，这样也省去了以后维护的麻烦，如果看不懂，先在此说声抱歉。


## 所需步骤

### 关键词
首先我默认你已经懂得了一下词汇的概念，`路由器`、`IP`、`网关`、`PPPOE拨号`、`静态IP地址`、`DNS服务器`、`端口`，`内网IP`、`外网IP`、`防火墙`。
如果有任何其中不懂的词汇，Google 之。

### 流程

 1. 确认宽带提供商是否做了端口限制。
 2. 配置内网需要提供服务的服务器，设定防火墙规则和固定IP。
 2. 进入路由管理页面，确认上网方式，配置内外网的端口映射。
 3. 查询外网中的 IP 地址，使用外网环境访问映射后的服务器。
 4. 测试。


### 要点
 - 先确定宽带提供商是否对外网端口做了限制，如果限制，想办法开通。。
 - 内网服务器要确保是可以访问的，所以需要设置固定的内网 IP 地址，而不是使用路由动态分配的地址，保证主机在内网的 IP 是可达的状态。
 - 任何服务都有一个端口，明确服务器需要提供的服务端口，确保其不在服务器的防火墙内。
 - 使用另一台电脑验证内网的服务器是否联通，`192.168.1.XX:服务器的端口`，通过之后方可继续。
 - 路由器大都提供端口映射的功能，原理是将路由器的内网服务以端口的形式暴露给外部网络。配置端口映射后，路由器会将外网针对暴露端口的访问转发给内网配置好的服务器，如`192.168.1.XX:服务器的端口` 中。
 - 如果你的上网方式是静态IP上网 ，那么恭喜你，配置好路由的映射就可以直接通过路由器的外网 IP 地址加端口号访问自己搭设的服务器了。
 - 如果你是 PPPOE 方式上网，那么你的外网 IP 地址是服务商动态分配的。这就出现了一个问题，一旦通信公司动态分配给出你的 外网 IP 有了变化，你通过原有的外网 IP 就会找不到自己的路由器了，于是就访问不到自己的服务。那么你需要知道新的 IP 才能够访问内网服务器。 这很不方便不是么？
 - 解决这个问题也不难，配置一台动态的 DNS 服务就好了，自动的获取路由器最新的IP ，更新访问地址。
 - 有些路由器中内嵌了动态域名的配置，找到路由器支持的提供商注册登记，将账号密码输入，配置妥当之后，不出意外就能使用了。
 - 使用动态域名在内网能够访问，不能说明配置成功了。还需要客户端在外网环境下测试一下，如果不通，你需要排查如下的问题：
     - 服务商的端口限制
     - 路由的动态服务地址断开（重连或是使用靠谱的服务。）


## 最后

按照步骤和要点，应该就能实现远程访问内网服务了。

## 资源

 - [查看IP][1]


  [1]: http://ddns.oray.com/checkip
